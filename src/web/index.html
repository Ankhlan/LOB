<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRE.mn - Mongolian Derivatives Exchange</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style-v2.css">
</head>
<body data-theme="light">
    <!-- HEADER BAR - 36px -->
    <header class="header">
        <div class="header-left">
            <span class="logo">CRE<span class="logo-suffix">.mn</span></span>
            <span class="logo-tag">Mongolian Futures Exchange</span>
        </div>
        <div class="header-center">
            <div class="rate-display">
                <span class="rate-label">BoM Rate</span>
                <span class="rate-value" id="bomRate">3,564.00</span>
            </div>
            <div class="status-indicator connected" id="status">
                <span class="status-dot"></span>
                <span class="status-text">LIVE</span>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn" id="themeToggle">Theme</button>
            <button class="header-btn" id="langToggle">EN</button>
            <button class="header-btn primary" id="loginBtn">Connect</button>
        </div>
    </header>

    <!-- MAIN GRID: Left 240px | Center flex | Right 280px -->
    <main class="main-grid">
        <!-- LEFT PANEL: Market Watch -->
        <aside class="panel panel-left">
            <div class="panel-header">
                <span class="panel-title">Markets</span>
                <input type="text" class="search-input" id="searchMarket" placeholder="Search...">
            </div>
            <div class="category-filter">
                <button class="cat-btn active" data-cat="all">All</button>
                <button class="cat-btn" data-cat="fx">FX</button>
                <button class="cat-btn" data-cat="commodities">Comm</button>
                <button class="cat-btn" data-cat="crypto">Crypto</button>
                <button class="cat-btn" data-cat="mongolia">MN</button>
            </div>
            <div class="market-grid">
                <table class="data-table market-table">
                    <thead>
                        <tr>
                            <th class="col-symbol">Symbol</th>
                            <th class="col-bid num">Bid</th>
                            <th class="col-ask num">Ask</th>
                            <th class="col-chg num">Chg%</th>
                        </tr>
                    </thead>
                    <tbody id="marketList">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </aside>

        <!-- CENTER: Chart + Bottom -->
        <section class="panel panel-center">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="selected-market">
                        <span class="market-symbol" id="selectedSymbol">XAU-MNT-PERP</span>
                        <span class="market-price" id="selectedPrice">-</span>
                        <span class="market-change" id="selectedChange">-</span>
                    </div>
                    <div class="chart-stats">
                        <span class="stat">24h H: <span id="high24h">-</span></span>
                        <span class="stat">24h L: <span id="low24h">-</span></span>
                        <span class="stat">Vol: <span id="vol24h">-</span></span>
                    </div>
                    <div class="chart-controls">
                        <div class="timeframe-selector">
                            <button class="tf-btn" data-tf="1">1m</button>
                            <button class="tf-btn" data-tf="5">5m</button>
                            <button class="tf-btn active" data-tf="15">15m</button>
                            <button class="tf-btn" data-tf="60">1H</button>
                            <button class="tf-btn" data-tf="240">4H</button>
                            <button class="tf-btn" data-tf="D">1D</button>
                        </div>
                    </div>
                </div>
                <div class="chart-canvas" id="chartCanvas"></div>
            </div>

            <!-- Bottom Panel -->
            <div class="bottom-panel">
                <div class="tab-bar">
                    <button class="tab active" data-tab="positions">Positions <span class="badge" id="posCount">0</span></button>
                    <button class="tab" data-tab="orders">Orders <span class="badge" id="orderCount">0</span></button>
                    <button class="tab" data-tab="history">History</button>
                    <div class="tab-spacer"></div>
                    <div class="pnl-summary">
                        <span class="pnl-label">Total PnL:</span>
                        <span class="pnl-value" id="totalPnl">+0 MNT</span>
                    </div>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="positionsPane">
                        <table class="data-table positions-table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th class="num">Size</th>
                                    <th class="num">Entry</th>
                                    <th class="num">Mark</th>
                                    <th class="num">PnL</th>
                                    <th class="num">PnL%</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="positionsGrid">
                                <tr class="empty-row"><td colspan="8">No open positions</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="tab-pane" id="ordersPane">
                        <table class="data-table orders-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th>Type</th>
                                    <th class="num">Price</th>
                                    <th class="num">Qty</th>
                                    <th>Status</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="ordersGrid">
                                <tr class="empty-row"><td colspan="8">No open orders</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="tab-pane" id="historyPane">
                        <table class="data-table history-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th class="num">Price</th>
                                    <th class="num">Qty</th>
                                    <th class="num">rPnL</th>
                                </tr>
                            </thead>
                            <tbody id="historyGrid">
                                <tr class="empty-row"><td colspan="6">No trade history</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- RIGHT PANEL: Orderbook + Trade + Market Info -->
        <aside class="panel panel-right">
            <!-- Order Book -->
            <div class="orderbook">
                <div class="panel-header">
                    <span class="panel-title">Order Book</span>
                </div>
                <div class="orderbook-grid">
                    <div class="ob-header-row">
                        <span>Price</span>
                        <span class="num">Size</span>
                        <span class="num">Total</span>
                    </div>
                    <div class="ob-asks" id="obAsks"></div>
                    <div class="ob-spread">
                        <span class="spread-label">Spread</span>
                        <span class="spread-value" id="spreadValue">-</span>
                        <span class="spread-bps" id="spreadBps">-</span>
                    </div>
                    <div class="ob-bids" id="obBids"></div>
                </div>
            </div>

            <!-- Trade Entry -->
            <div class="trade-form">
                <div class="panel-header">
                    <span class="panel-title">Trade</span>
                </div>
                <div class="side-selector">
                    <button class="side-btn buy active" data-side="buy">BUY</button>
                    <button class="side-btn sell" data-side="sell">SELL</button>
                </div>
                <div class="form-row">
                    <label>Size</label>
                    <div class="size-input-group">
                        <input type="text" class="form-input num" id="orderQty" value="1">
                        <span class="size-unit" id="sizeUnit">XAU</span>
                    </div>
                </div>
                <div class="size-slider">
                    <input type="range" class="slider" id="sizeSlider" min="0" max="100" value="25">
                    <div class="slider-labels">
                        <span>0%</span>
                        <span>25%</span>
                        <span>50%</span>
                        <span>75%</span>
                        <span>100%</span>
                    </div>
                </div>
                <div class="trade-buttons">
                    <button class="trade-btn buy" id="buyBtn">
                        <span class="trade-action">BUY</span>
                        <span class="trade-price" id="buyPrice">-</span>
                    </button>
                    <button class="trade-btn sell" id="sellBtn">
                        <span class="trade-action">SELL</span>
                        <span class="trade-price" id="sellPrice">-</span>
                    </button>
                </div>
                <div class="order-estimate">
                    <div class="est-row">
                        <span>Est. Cost</span>
                        <span class="num" id="estCost">- MNT</span>
                    </div>
                    <div class="est-row">
                        <span>Margin</span>
                        <span class="num" id="estMargin">- MNT</span>
                    </div>
                </div>
            </div>

            <!-- Market Info - Transparency Panel -->
            <div class="market-info">
                <div class="panel-header">
                    <span class="panel-title">Market Info</span>
                </div>
                <div class="info-grid">
                    <div class="info-section">
                        <div class="info-row">
                            <span>24h Volume</span>
                            <span class="num" id="infoVolume">-</span>
                        </div>
                        <div class="info-row">
                            <span>Open Interest</span>
                            <span class="num" id="infoOI">-</span>
                        </div>
                        <div class="info-row">
                            <span>Funding Rate</span>
                            <span class="num" id="infoFunding">-</span>
                        </div>
                        <div class="info-row">
                            <span>Next Funding</span>
                            <span class="num" id="infoNextFunding">-</span>
                        </div>
                    </div>
                    <div class="info-section transparency">
                        <div class="section-label">Price Source</div>
                        <div class="info-row">
                            <span>FXCM Symbol</span>
                            <span class="num" id="fxcmSymbol">-</span>
                        </div>
                        <div class="info-row">
                            <span>FXCM Price (USD)</span>
                            <span class="num" id="fxcmPrice">-</span>
                        </div>
                        <div class="info-row">
                            <span>USD/MNT Rate</span>
                            <span class="num" id="usdMntRate">-</span>
                        </div>
                        <div class="info-row calculation">
                            <span>Calculation</span>
                            <span class="num" id="priceCalc">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-box">
            <div class="modal-header">
                <h3>Connect to CRE.mn</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Phone Number</label>
                    <div class="phone-input">
                        <span class="country-code">+976</span>
                        <input type="tel" class="form-input" id="phoneInput" placeholder="99001234" maxlength="8">
                    </div>
                </div>
                <button class="btn-primary" id="sendOtp">Send Code</button>
                <div class="otp-section hidden" id="otpSection">
                    <div class="form-group">
                        <label>Verification Code</label>
                        <input type="text" class="form-input" id="otpInput" placeholder="6-digit code" maxlength="6">
                    </div>
                    <button class="btn-primary" id="verifyOtp">Verify</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="cre-chart.js"></script>
    <script src="app-v2.js"></script>
</body>
</html>
