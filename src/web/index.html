<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRE.mn | Mongolian Derivatives Exchange</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="cre-v3.css">
</head>
<body data-theme="dark">
    <!-- TOP BAR - Ultra compact -->
    <header class="topbar">
        <div class="topbar-left">
            <div class="brand">
                <span class="brand-logo">CRE</span>
                <span class="brand-suffix">.mn</span>
            </div>
            <nav class="main-nav">
                <button class="nav-item active" data-view="trade">Trade</button>
                <button class="nav-item" data-view="markets">Markets</button>
                <button class="nav-item" data-view="portfolio">Portfolio</button>
                <button class="nav-item" data-view="products">Products</button>
                <button class="nav-item" data-view="earn">Earn</button>
            </nav>
            <div class="bom-rate" title="Bank of Mongolia Reference Rate">
                <span class="bom-label">BoM Rate</span>
                <span class="bom-value" id="bomRate">-</span>
            </div>
            <div class="connection-status" id="connectionStatus" title="Connection Status">
                <span class="status-dot"></span>
                <span class="status-text">Connected</span>
            </div>
        </div>
        <div class="topbar-center">
            <div class="instrument-display" id="instrumentDisplay">
                <span class="inst-symbol" id="topSymbol">XAU-MNT</span>
                <span class="inst-price" id="topPrice">-</span>
                <span class="inst-mark-price" id="topMarkPrice" title="Mark Price">Mark: <span id="markPriceValue">-</span></span>
                <span class="inst-index-price" id="topIndexPrice" title="Index Price">Index: <span id="indexPriceValue">-</span></span>
                <span class="inst-change positive" id="topChange">-</span>
                <span class="inst-highlow" id="topHighLow">24h H/L: <span id="high24h">-</span> / <span id="low24h">-</span></span>
                <span class="inst-volume" id="topVolume">24h Vol: -</span>
                <span class="inst-oi" id="topOI" title="Open Interest">OI: <span id="oiValue">-</span></span>
                <span class="inst-spread" id="topSpread">Spread: <span id="spreadBps">-</span> bps</span>
                <span class="inst-funding" id="topFunding">Funding: <span id="fundingRate">-</span> in <span id="fundingCountdown">-</span></span>
            </div>
        </div>
        <div class="topbar-right">
            <div class="account-info" id="accountInfo">
                <div class="equity-display">
                    <span class="eq-label">Equity</span>
                    <span class="eq-value" id="topEquity">-</span>
                </div>
                <div class="pnl-display">
                    <span class="pnl-label">Day PnL</span>
                    <span class="pnl-value" id="topPnl">-</span>
                </div>
            </div>
            <div class="quick-actions">
                <button class="qa-btn" id="themeToggle" title="Toggle theme">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>
                </button>
                <button class="qa-btn" id="langToggle" title="Language">EN</button>
                <button class="qa-btn" id="settingsBtn" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                </button>
            </div>
            <button class="login-btn" id="loginBtn">Connect</button>
        </div>
    </header>

    <!-- MAIN WORKSPACE - Flexible Grid -->
    <main class="workspace">
        <!-- LEFT RAIL - Instrument selector -->
        <aside class="rail rail-left" id="leftRail">
            <div class="rail-header">
                <input type="text" class="search-box" id="searchInstrument" placeholder="Search markets...">
            </div>
            <div class="instrument-groups" id="instrumentGroups">
                <div class="inst-group" data-group="favorites">
                    <div class="group-header">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                        <span>Favorites</span>
                    </div>
                    <div class="group-items" id="favoritesList"></div>
                </div>
                <div class="inst-group" data-group="mn">
                    <div class="group-header">
                        <span class="flag-mn">MN</span>
                        <span>Mongolia</span>
                    </div>
                    <div class="group-items" id="mnList"></div>
                </div>
                <div class="inst-group expanded" data-group="fx">
                    <div class="group-header">
                        <span>FX</span>
                    </div>
                    <div class="group-items" id="fxList"></div>
                </div>
                <div class="inst-group" data-group="crypto">
                    <div class="group-header">
                        <span>Crypto</span>
                    </div>
                    <div class="group-items" id="cryptoList"></div>
                </div>
                <div class="inst-group" data-group="commodities">
                    <div class="group-header">
                        <span>Commodities</span>
                    </div>
                    <div class="group-items" id="commoditiesList"></div>
                </div>
                <div class="inst-group" data-group="indices">
                    <div class="group-header">
                        <span>Indices</span>
                    </div>
                    <div class="group-items" id="indicesList"></div>
                </div>
            </div>
        </aside>

        <!-- CENTER - Chart dominant -->
        <section class="center-area">
            <!-- Chart Section -->
            <div class="chart-wrapper" id="chartWrapper">
                <div class="chart-toolbar">
                    <div class="toolbar-left">
                        <div class="tf-selector" id="tfSelector">
                            <button class="tf-btn" data-tf="1">1m</button>
                            <button class="tf-btn" data-tf="5">5m</button>
                            <button class="tf-btn active" data-tf="15">15m</button>
                            <button class="tf-btn" data-tf="60">1H</button>
                            <button class="tf-btn" data-tf="240">4H</button>
                            <button class="tf-btn" data-tf="D">1D</button>
                        </div>
                        <div class="chart-type-selector">
                            <button class="ct-btn active" data-type="candles" title="Candles">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="6" width="4" height="12"/><rect x="10" y="2" width="4" height="20"/><rect x="16" y="8" width="4" height="8"/></svg>
                            </button>
                            <button class="ct-btn" data-type="line" title="Line">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17l6-6 4 4 8-8"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="toolbar-right">
                        <button class="tool-btn" id="indicatorsBtn" title="Indicators">Indicators</button>
                        <button class="tool-btn" id="fullscreenBtn" title="Fullscreen">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="chart-canvas" id="chartCanvas"></div>
            </div>
            
            <!-- Bottom Panel - Collapsible -->
            <div class="bottom-panel" id="bottomPanel">
                <div class="panel-tabs">
                    <button class="panel-tab active" data-panel="positions">
                        Positions <span class="count" id="posCount">0</span>
                    </button>
                    <button class="panel-tab" data-panel="orders">
                        Orders <span class="count" id="orderCount">0</span>
                    </button>
                    <button class="panel-tab" data-panel="fills">Fills</button>
                      <button class="panel-tab" data-panel="history">History</button>
                    <button class="panel-tab" data-panel="alerts">Alerts</button>
                    <div class="panel-spacer"></div>
                    <button class="panel-toggle" id="panelToggle">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
                    </button>
                </div>
                <div class="panel-content" id="panelContent">
                    <div class="panel-view active" id="viewPositions">
                        <table class="data-grid">
                            <thead>
                                <tr><th>Symbol</th><th>Side</th><th>Size</th><th>Entry</th><th>Mark</th><th>Liq.</th><th>uPnL</th><th></th></tr>
                            </thead>
                            <tbody id="positionsGrid"></tbody>
                        </table>
                    </div>
                    <div class="panel-view" id="viewOrders">
                        <table class="data-grid">
                            <thead>
                                <tr><th>Time</th><th>Symbol</th><th>Type</th><th>Side</th><th>Price</th><th>Qty</th><th>Filled</th><th></th></tr>
                            </thead>
                            <tbody id="ordersGrid"></tbody>
                        </table>
                    </div>
                    <div class="panel-view" id="viewFills">
                        <table class="data-grid">
                            <thead>
                                <tr><th>Time</th><th>Symbol</th><th>Side</th><th>Price</th><th>Qty</th><th>Fee</th><th>rPnL</th></tr>
                            </thead>
                            <tbody id="fillsGrid"></tbody>
                        </table>
                    </div>
                    <div class="panel-view" id="viewHistory">
                        <table class="data-grid">
                            <thead>
                                <tr><th>Time</th><th>Symbol</th><th>Side</th><th>Type</th><th>Qty</th><th>Price</th><th>Status</th></tr>
                            </thead>
                            <tbody id="historyGrid"></tbody>
                        </table>
                    </div>
                    <div class="panel-view" id="viewAlerts">
                        <div class="alerts-empty">No active alerts</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- RIGHT RAIL - Order entry + book -->
        <aside class="rail rail-right" id="rightRail">
            <!-- Order Book -->
            <div class="orderbook" id="orderBook">
                <div class="ob-header">
                    <span class="ob-title">Order Book</span>
                    <div class="ob-precision">
                        <button class="prec-btn active" data-prec="0.01">0.01</button>
                        <button class="prec-btn" data-prec="0.1">0.1</button>
                        <button class="prec-btn" data-prec="1">1</button>
                    </div>
                </div>
                <div class="ob-grid">
                    <div class="depth-chart"><canvas id="depthCanvas" width="280" height="60"></canvas></div>
                      <div class="ob-header-row">
                        <span>Price</span><span>Size</span><span>Total</span>
                    </div>
                    <div class="ob-asks" id="obAsks"></div>
                    <div class="ob-spread" id="obSpread">
                        <span class="spread-price">-</span>
                        <span class="spread-pct">-</span>
                    </div>
                    <div class="ob-bids" id="obBids"></div>
                </div>
            </div>
            
            <!-- Trade Entry -->
            <div class="trade-entry" id="tradeEntry">
                <div class="te-header">
                    <div class="side-toggle">
                        <button class="side-btn buy active" data-side="buy">Long</button>
                        <button class="side-btn sell" data-side="sell">Short</button>
                    </div>
                </div>
                <div class="te-form">
                    <div class="order-types">
                        <button class="ot-btn active" data-type="limit">Limit</button>
                        <button class="ot-btn" data-type="market">Market</button>
                        <button class="ot-btn" data-type="stop">Stop</button>
                    </div>
                    
                    <div class="form-row price-row" id="priceRow">
                        <label>Price</label>
                        <div class="input-group">
                            <button class="adj-btn" data-adj="-1">-</button>
                            <input type="text" class="form-input" id="orderPrice" value="">
                            <button class="adj-btn" data-adj="+1">+</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <label>Size</label>
                        <div class="input-group">
                            <input type="text" class="form-input" id="orderSize" value="1">
                            <span class="input-suffix">Contracts</span>
                        </div>
                            <div class="quick-sizes">
                                <button class="quick-size-btn" data-size="1000">1K</button>
                                <button class="quick-size-btn" data-size="5000">5K</button>
                                <button class="quick-size-btn" data-size="10000">10K</button>
                                <button class="quick-size-btn" data-size="50000">50K</button>
                            </div>
                          <div class="size-presets">
                              <button class="preset-btn" data-pct="25">25%</button>
                              <button class="preset-btn" data-pct="50">50%</button>
                              <button class="preset-btn" data-pct="75">75%</button>
                              <button class="preset-btn" data-pct="100">MAX</button>
                          </div>
                        <div class="size-presets">
                            <button class="preset-btn" data-pct="25">25%</button>
                            <button class="preset-btn" data-pct="50">50%</button>
                            <button class="preset-btn" data-pct="75">75%</button>
                            <button class="preset-btn" data-pct="100">Max</button>
                        </div>
                    </div>
                    
                    <div class="form-row leverage-row">
                        <label>Leverage</label>
                        <div class="leverage-control">
                            <input type="range" class="lev-slider" id="levSlider" min="1" max="100" value="10">
                            <div class="lev-display" id="levDisplay">10x</div>
                        </div>
                        <div class="lev-presets">
                            <button class="preset-btn" data-lev="1">1x</button>
                            <button class="preset-btn" data-lev="5">5x</button>
                            <button class="preset-btn active" data-lev="10">10x</button>
                            <button class="preset-btn" data-lev="25">25x</button>
                            <button class="preset-btn" data-lev="50">50x</button>
                        </div>
                    </div>
                    
                    <div class="order-summary">
                        <div class="sum-row"><span>Order Value</span><span id="sumValue">-</span></div>
                        <div class="sum-row"><span>Margin Required</span><span id="sumMargin">-</span></div>
                        <div class="sum-row"><span>Est. Fee</span><span id="sumFee">-</span></div>
                    </div>
                    
                    <div class="order-options">
                        <label class="toggle-option">
                            <input type="checkbox" id="reduceOnly">
                            <span class="toggle-label">Reduce Only</span>
                        </label>
                        <label class="toggle-option">
                            <input type="checkbox" id="postOnly">
                            <span class="toggle-label">Post Only</span>
                        </label>
                    </div>
                    <button class="submit-order buy" id="submitOrder">Long XAU-MNT</button>
                </div>
            </div>
            
            <!-- Recent Trades -->
            <div class="recent-trades" id="recentTrades">
                <div class="rt-header">Recent Trades</div>
                <div class="rt-list" id="rtList"></div>
            </div>
        </aside>
    </main>

    <!-- Products View (hidden by default) -->
    <section class="view-panel products-view" id="productsView" style="display: none;">
        <div class="products-container">
            <header class="products-header">
                <h1>Products</h1>
                <p class="subtitle">Perpetual Futures Contracts</p>
            </header>

            <!-- Featured Product: USD-MNT-PERP -->
            <div class="product-card featured" id="productUsdMnt">
                <div class="product-header">
                    <div class="product-icon">ðŸ‡²ðŸ‡³</div>
                    <div class="product-title">
                        <h2>USD-MNT-PERP</h2>
                        <span class="product-type">Perpetual Swap</span>
                    </div>
                    <div class="product-price" id="productPrice">3,564 MNT</div>
                </div>
                
                <div class="product-stats">
                    <div class="stat">
                        <label>24h Volume</label>
                        <span id="productVolume">--</span>
                    </div>
                    <div class="stat">
                        <label>Open Interest</label>
                        <span id="productOI">--</span>
                    </div>
                    <div class="stat">
                        <label>Funding Rate</label>
                        <span id="productFunding">+0.01%</span>
                    </div>
                    <div class="stat">
                        <label>Leverage</label>
                        <span>Up to 100x</span>
                    </div>
                </div>

                <div class="product-specs">
                    <h3>Contract Specifications</h3>
                    <table class="specs-table">
                        <tr><td>Underlying</td><td>USD/MNT Exchange Rate</td></tr>
                        <tr><td>Contract Size</td><td>1 USD</td></tr>
                        <tr><td>Settlement</td><td>Cash (MNT)</td></tr>
                        <tr><td>Tick Size</td><td>1 MNT</td></tr>
                        <tr><td>Trading Hours</td><td>24/7</td></tr>
                        <tr><td>Circuit Breaker</td><td>Â±5% Daily Limit</td></tr>
                    </table>
                </div>

                <div class="product-actions">
                    <button class="btn-trade buy" onclick="switchView('trade'); selectInstrument('USD-MNT-PERP');">
                        Trade USD-MNT-PERP
                    </button>
                </div>
            </div>

            <!-- Other products list placeholder -->
            <div class="products-list" id="productsList">
                <h3>All Products</h3>
                <div class="product-grid">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>
    </section>

    <!-- Connection Status -->
    <div class="connection-status" id="connStatus">
        <span class="conn-dot"></span>
        <span class="conn-text">Connecting...</span>
    </div>

    <!-- Login Modal -->
    <div class="modal-backdrop hidden" id="modalBackdrop"></div>
    <div class="modal hidden" id="loginModal">
        <div class="modal-header">
            <h3>Connect to CRE.mn</h3>
            <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-body">
            <div class="login-step active" id="stepPhone">
                <p>Enter your Mongolian phone number</p>
                <div class="phone-input">
                    <span class="country-code">+976</span>
                    <input type="tel" class="phone-field" id="phoneField" placeholder="99001234" maxlength="8">
                </div>
                <button class="modal-btn primary" id="sendCodeBtn">Send Code</button>
            </div>
            <div class="login-step" id="stepOtp">
                <p>Enter the 6-digit code sent to your phone</p>
                <div class="otp-row" id="otpRow">
                    <input type="text" class="otp-digit" maxlength="1">
                    <input type="text" class="otp-digit" maxlength="1">
                    <input type="text" class="otp-digit" maxlength="1">
                    <input type="text" class="otp-digit" maxlength="1">
                    <input type="text" class="otp-digit" maxlength="1">
                    <input type="text" class="otp-digit" maxlength="1">
                </div>
                <button class="modal-btn primary" id="verifyBtn">Verify</button>
                <button class="modal-btn link" id="changeNumBtn">Change number</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="cre-chart.js"></script>
    <script type="module" src="app-v3.js"></script>
    <script src="modules/bootstrap.js"></script>
</body>
</html>





