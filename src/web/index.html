<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRE.mn ‚Äî Mongolian Derivatives Exchange</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#E5C07B">
</head>
<body>
    <!-- ==================== HEADER BAR ==================== -->
    <header class="header">
        <div class="header-left">
            <div class="logo-group">
                <span class="logo">CRE<span class="logo-dot">.</span><span class="logo-suffix">mn</span></span>
                <span class="logo-tag">Mongolian Futures Exchange</span>
            </div>
        </div>
        <div class="header-center">
            <div class="header-ticker" id="headerTicker">
                <span class="ticker-symbol" id="headerSymbol">‚Äî</span>
                <span class="ticker-price" id="headerPrice">‚Äî</span>
                <span class="ticker-change" id="headerChange">‚Äî</span>
            </div>
            <div class="header-divider"></div>
            <div class="rate-pill">
                <span class="rate-label">BoM</span>
                <span class="rate-value" id="bomRate">3,564.00</span>
            </div>
            <div class="header-divider"></div>
            <div class="latency-pill" id="latencyPill" title="Roundtrip latency">
                <span class="latency-dot" id="latencyDot"></span>
                <span class="latency-val" id="latencyVal">‚Äî</span>
            </div>
            <div class="conn-status" id="connStatus">
                <span class="conn-dot"></span>
                <span class="conn-text">CONNECTING</span>
            </div>
        </div>
        <div class="header-right">
            <div class="balance-pill hidden" id="balancePill">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M16 12h2"/></svg>
                <span class="bal-equity" id="headerEquity">‚Äî</span>
                <span class="bal-pnl" id="headerPnl">‚Äî</span>
                <button class="bal-toggle" id="walletBtn" title="Account &amp; Wallet">
                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
            </div>
            <button class="hdr-btn" id="themeToggle" title="Toggle theme (T)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
            </button>
            <button class="hdr-btn" id="langToggle">EN</button>
            <button class="hdr-btn" id="shortcutsBtn" title="Keyboard shortcuts (?)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"/><line x1="6" y1="10" x2="6" y2="10.01"/><line x1="10" y1="10" x2="10" y2="10.01"/><line x1="14" y1="10" x2="14" y2="10.01"/><line x1="18" y1="10" x2="18" y2="10.01"/><line x1="8" y1="14" x2="16" y2="14"/></svg>
            </button>
            <button class="hdr-btn accent" id="loginBtn">Connect</button>
        </div>
    </header>

    <!-- Connection / Circuit Breaker Banners -->
    <div class="conn-banner hidden" id="connBanner"><span id="connBannerText">Connection lost</span></div>
    <div class="cb-banner hidden" id="cbBanner"><span id="cbBannerIcon">‚ö†</span> <span id="cbBannerText"></span></div>

    <!-- ==================== MENU BAR ==================== -->
    <nav class="menubar" id="menuBar">
        <button class="menu-hamburger" id="menuHamburger">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
        
        <div class="menu-item">
            <span class="menu-label" data-i18n="menu.file">File</span>
            <div class="menu-dropdown">
                <div class="menu-action" id="menuConnect">Connect</div>
                <div class="menu-action" id="menuDisconnect">Disconnect</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuExportCSV">Export Data...</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuSaveWorkspace">Save Workspace...</div>
                <div class="menu-action" id="menuLoadWorkspace">Load Workspace</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuPrefs">Preferences</div>
            </div>
        </div>
        
        <div class="menu-item">
            <span class="menu-label" data-i18n="menu.view">View</span>
            <div class="menu-dropdown">
                <div class="menu-action checkable" id="menuShowLeft" data-checked="true">Left Panel</div>
                <div class="menu-action checkable" id="menuShowBook" data-checked="true">Order Book</div>
                <div class="menu-action checkable" id="menuShowChart" data-checked="true">Chart</div>
                <div class="menu-action checkable" id="menuShowTrade" data-checked="true">Trade Panel</div>
                <div class="menu-action checkable" id="menuShowBottom" data-checked="true">Bottom Panel</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuResetLayout">Reset Layout</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuMarketInfo">Market Info</div>
                <div class="menu-action" id="menuBankRates">Bank Rates</div>
                <div class="menu-action" id="menuTransparency">Transparency</div>
            </div>
        </div>
        
        <div class="menu-item">
            <span class="menu-label" data-i18n="menu.trade">Trade</span>
            <div class="menu-dropdown">
                <div class="menu-action" id="menuBuyLong">Buy/Long <span class="menu-shortcut">B</span></div>
                <div class="menu-action" id="menuSellShort">Sell/Short <span class="menu-shortcut">S</span></div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuOrderMarket">Market Order <span class="menu-shortcut">M</span></div>
                <div class="menu-action" id="menuOrderLimit">Limit Order <span class="menu-shortcut">L</span></div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuCloseAll">Close All Positions</div>
                <div class="menu-action" id="menuCancelAll">Cancel All Orders <span class="menu-shortcut">Esc</span></div>
            </div>
        </div>
        
        <div class="menu-item">
            <span class="menu-label" data-i18n="menu.market">Market</span>
            <div class="menu-dropdown">
                <div class="menu-action" id="menuUSDMNT">USD-MNT-PERP</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuFX">FX</div>
                <div class="menu-action" id="menuCmdty">Commodities</div>
                <div class="menu-action" id="menuCrypto">Crypto</div>
                <div class="menu-action" id="menuMN">Mongolia</div>
            </div>
        </div>
        
        <div class="menu-item">
            <span class="menu-label" data-i18n="menu.tools">Tools</span>
            <div class="menu-dropdown">
                <div class="menu-action" id="menuCalc">Position Calculator</div>
                <div class="menu-action" id="menuPnLCalc">PnL Calculator</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuAlerts">Price Alerts</div>
                <div class="menu-action" id="menuNotifs">Notifications</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuAPI">API Keys</div>
                <div class="menu-action" id="menuLedgerView">Ledger</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuAdmin">Admin Panel</div>
            </div>
        </div>
        
        <div class="menu-item">
            <span class="menu-label" data-i18n="menu.help">Help</span>
            <div class="menu-dropdown">
                <div class="menu-action" id="menuDocs">Documentation</div>
                <div class="menu-action" id="menuShortcuts">Keyboard Shortcuts <span class="menu-shortcut">?</span></div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuFees">Fee Schedule</div>
                <div class="menu-action" id="menuContracts">Contract Specs</div>
                <div class="menu-divider"></div>
                <div class="menu-action" id="menuAbout">About</div>
            </div>
        </div>
    </nav>

    <!-- ==================== MAIN LAYOUT ==================== -->
    <main class="workspace">

        <!-- LEFT PANEL: Market Watch -->
        <aside class="panel panel-left" id="panelLeft">
            <div class="panel-head">
                <span class="panel-label" data-i18n="markets.title">Markets</span>
                <div class="search-box">
                    <svg class="search-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" class="search-input" id="searchMarket" placeholder="Filter  (/)" spellcheck="false">
                </div>
            </div>
            <div class="cat-row">
                <button class="cat-btn active" data-cat="all" data-i18n="markets.all">All</button>
                <button class="cat-btn" data-cat="fx" data-i18n="markets.fx">FX</button>
                <button class="cat-btn" data-cat="commodities" data-i18n="markets.commodities">Comm</button>
                <button class="cat-btn" data-cat="crypto" data-i18n="markets.crypto">Crypto</button>
                <button class="cat-btn" data-cat="mongolia" data-i18n="markets.mongolia">MN</button>
            </div>
            <div class="market-list-wrap">
                <table class="grid market-grid">
                    <thead>
                        <tr>
                            <th class="col-sym">Symbol</th>
                            <th class="col-num">Bid</th>
                            <th class="col-num">Ask</th>
                            <th class="col-num col-chg">Chg%</th>
                        </tr>
                    </thead>
                    <tbody id="marketList"></tbody>
                </table>
            </div>
        </aside>

        <!-- Resize handle: left ‚Üî center -->
        <div class="resize-col" id="resizeLeft"></div>

        <!-- CENTER: Chart + Bottom Panels -->
        <section class="panel panel-center">
            <div class="chart-bar">
                <div class="chart-bar-left">
                    <span class="chart-symbol" id="chartSymbol">‚Äî</span>
                    <span class="chart-price" id="chartPrice">‚Äî</span>
                    <span class="chart-change" id="chartChange">‚Äî</span>
                </div>
                <div class="chart-bar-stats">
                    <div class="stat-item"><span class="stat-label" data-i18n="chart.stat_high_24h">24h H</span><span class="stat-val" id="stat24hH">‚Äî</span></div>
                    <div class="stat-item"><span class="stat-label" data-i18n="chart.stat_low_24h">24h L</span><span class="stat-val" id="stat24hL">‚Äî</span></div>
                    <div class="stat-item"><span class="stat-label" data-i18n="chart.stat_vol">Vol</span><span class="stat-val" id="stat24hV">‚Äî</span></div>
                    <div class="stat-item"><span class="stat-label" data-i18n="chart.stat_oi">OI</span><span class="stat-val" id="stat24hOI">‚Äî</span></div>
                </div>
                <div class="tf-group">
                    <button class="tf-btn" data-tf="1">1m</button>
                    <button class="tf-btn" data-tf="5">5m</button>
                    <button class="tf-btn active" data-tf="15">15m</button>
                    <button class="tf-btn" data-tf="60">1H</button>
                    <button class="tf-btn" data-tf="240">4H</button>
                    <button class="tf-btn" data-tf="D">1D</button>
                </div>
            </div>

            <div class="chart-area" id="chartCanvas"></div>

            <!-- Bottom Panel -->
            <div class="bottom-panel" id="bottomPanel">
                <div class="bottom-tabs">
                    <button class="btab active" data-tab="positions" data-i18n="tab.positions">Positions <span class="btab-badge" id="posCount">0</span></button>
                    <button class="btab" data-tab="orders" data-i18n="tab.orders">Orders <span class="btab-badge" id="orderCount">0</span></button>
                    <button class="btab" data-tab="history" data-i18n="tab.history">History</button>
                    <button class="btab" data-tab="trades" data-i18n="tab.trades">Trades <span class="btab-badge live-badge"></span></button>
                    <button class="btab" data-tab="account" data-i18n="tab.account">Account</button>
                    <button class="btab" data-tab="insurance" data-i18n="tab.insurance">Insurance</button>
                    <div class="btab-spacer"></div>
                    <div class="pnl-row">
                        <span class="pnl-label" data-i18n="tab.total_pnl">Total PnL</span>
                        <span class="pnl-val" id="totalPnl">0 MNT</span>
                    </div>
                </div>

                <div class="btab-pane active" id="pane-positions">
                    <table class="grid"><thead><tr>
                        <th data-i18n="pos.symbol">Symbol</th><th data-i18n="pos.side">Side</th><th class="col-num" data-i18n="pos.size">Size</th>
                        <th class="col-num" data-i18n="pos.entry">Entry</th><th class="col-num" data-i18n="pos.mark">Mark</th>
                        <th class="col-num" data-i18n="pos.liq">Liq.</th><th class="col-num" data-i18n="pos.pnl">PnL</th>
                        <th class="col-num">PnL%</th><th class="col-act"></th>
                    </tr></thead>
                    <tbody id="positionsBody"><tr class="empty-row"><td colspan="9" data-i18n="positions.empty">No open positions</td></tr></tbody>
                    </table>
                </div>

                <div class="btab-pane" id="pane-orders">
                    <table class="grid"><thead><tr>
                        <th data-i18n="ord.time">Time</th><th data-i18n="ord.symbol">Symbol</th><th data-i18n="ord.side">Side</th><th data-i18n="ord.type">Type</th>
                        <th class="col-num" data-i18n="ord.price">Price</th><th class="col-num" data-i18n="ord.qty">Qty</th>
                        <th class="col-num" data-i18n="ord.filled">Filled</th><th data-i18n="ord.status">Status</th><th class="col-act"></th>
                    </tr></thead>
                    <tbody id="ordersBody"><tr class="empty-row"><td colspan="9" data-i18n="orders.empty">No open orders</td></tr></tbody>
                    </table>
                </div>

                <div class="btab-pane" id="pane-history">
                    <table class="grid"><thead><tr>
                        <th data-i18n="ord.time">Time</th><th data-i18n="ord.symbol">Symbol</th><th data-i18n="ord.side">Side</th>
                        <th class="col-num" data-i18n="ord.price">Price</th><th class="col-num" data-i18n="ord.qty">Qty</th>
                        <th class="col-num" data-i18n="hist.fee">Fee</th><th class="col-num" data-i18n="hist.rpnl">rPnL</th>
                    </tr></thead>
                    <tbody id="historyBody"><tr class="empty-row"><td colspan="7" data-i18n="history.empty">No trade history</td></tr></tbody>
                    </table>
                </div>

                <div class="btab-pane" id="pane-trades">
                    <table class="grid"><thead><tr>
                        <th data-i18n="trades.time">Time</th><th data-i18n="trades.price">Price</th><th class="col-num" data-i18n="trades.size">Size</th><th data-i18n="trades.side">Side</th>
                    </tr></thead>
                    <tbody id="tradesBody"><tr class="empty-row"><td colspan="4" data-i18n="trades.empty">Waiting for trades‚Ä¶</td></tr></tbody>
                    </table>
                </div>

                <div class="btab-pane" id="pane-account">
                    <div class="account-pane">
                        <div class="acct-grid">
                            <div class="acct-card"><div class="acct-card-label" data-i18n="acct.balance">Balance</div><div class="acct-card-val" id="acctBalance">‚Äî</div></div>
                            <div class="acct-card"><div class="acct-card-label" data-i18n="acct.equity">Equity</div><div class="acct-card-val" id="acctEquity">‚Äî</div></div>
                            <div class="acct-card"><div class="acct-card-label" data-i18n="acct.unrealized">Unrealized PnL</div><div class="acct-card-val" id="acctUPnL">‚Äî</div></div>
                            <div class="acct-card"><div class="acct-card-label" data-i18n="acct.margin_used">Margin Used</div><div class="acct-card-val" id="acctMargin">‚Äî</div></div>
                            <div class="acct-card"><div class="acct-card-label" data-i18n="acct.available">Available</div><div class="acct-card-val" id="acctAvail">‚Äî</div></div>
                            <div class="acct-card"><div class="acct-card-label" data-i18n="acct.margin_level">Margin Level</div><div class="acct-card-val" id="acctLevel">‚Äî</div></div>
                        </div>
                        <div class="acct-actions">
                            <button class="btn-deposit" id="depositBtn">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                <span data-i18n="acct.deposit">Deposit</span>
                            </button>
                            <button class="btn-withdraw" id="withdrawBtn">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                <span data-i18n="acct.withdraw">Withdraw</span>
                            </button>
                        </div>
                        <div class="acct-history">
                            <div class="acct-hist-label" data-i18n="acct.recent">Recent Transactions</div>
                            <div class="acct-hist-list" id="acctHistList">
                                <div class="acct-hist-empty" data-i18n="acct.no_transactions">No recent transactions</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="btab-pane" id="pane-insurance">
                    <div class="insurance-pane">
                        <!-- Fund Overview Cards -->
                        <div class="ins-grid">
                            <div class="ins-card primary">
                                <div class="ins-card-label" data-i18n="insurance.fund_balance">Insurance Fund Balance</div>
                                <div class="ins-card-val" id="insBalance">‚Äî</div>
                                <div class="ins-card-change" id="insChange">‚Äî</div>
                            </div>
                            <div class="ins-card">
                                <div class="ins-card-label" data-i18n="insurance.fund_ratio">Fund Ratio</div>
                                <div class="ins-card-val" id="insRatio">‚Äî</div>
                                <div class="ins-card-desc">% of Open Interest</div>
                            </div>
                            <div class="ins-card">
                                <div class="ins-card-label" data-i18n="insurance.liquidations_24h">Liquidations (24h)</div>
                                <div class="ins-card-val" id="insLiq24h">‚Äî</div>
                                <div class="ins-card-desc">Total Liquidated</div>
                            </div>
                            <div class="ins-card">
                                <div class="ins-card-label" data-i18n="insurance.fund_status">Fund Status</div>
                                <div class="ins-card-val status" id="insStatus">‚Äî</div>
                                <div class="ins-card-desc">Operational</div>
                            </div>
                        </div>

                        <!-- Recent Liquidations Section -->
                        <div class="ins-section">
                            <div class="ins-section-head">
                                <h3 data-i18n="insurance.recent_liquidations">Recent Liquidations</h3>
                                <button class="ins-refresh-btn" id="insRefreshBtn" title="Refresh">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="23 4 23 10 17 10"></polyline>
                                        <polyline points="1 20 1 14 7 14"></polyline>
                                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="ins-liquidations">
                                <table class="grid ins-grid">
                                    <thead>
                                        <tr>
                                            <th>Time</th>
                                            <th>Symbol</th>
                                            <th>Side</th>
                                            <th>Size</th>
                                            <th>Price</th>
                                            <th>Loss Recovered</th>
                                            <th>Fund Impact</th>
                                        </tr>
                                    </thead>
                                    <tbody id="insLiqBody">
                                        <tr class="empty-row">
                                            <td colspan="7" data-i18n="insurance.no_liquidations">No recent liquidations</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Fund Performance Chart -->
                        <div class="ins-section">
                            <div class="ins-section-head">
                                <h3 data-i18n="insurance.fund_history">Fund History (30 Days)</h3>
                                <div class="ins-timeframe-group">
                                    <button class="ins-tf-btn active" data-tf="7d">7D</button>
                                    <button class="ins-tf-btn" data-tf="30d">30D</button>
                                    <button class="ins-tf-btn" data-tf="90d">90D</button>
                                </div>
                            </div>
                            <div class="ins-chart-container">
                                <canvas id="insChart" width="800" height="300"></canvas>
                            </div>
                        </div>

                        <!-- Fund Info Footer -->
                        <div class="ins-info">
                            <p data-i18n="insurance.description">
                                The Insurance Fund protects traders from losses exceeding their margin during liquidations. 
                                It is funded by liquidation fees and trading profits. All fund movements are transparent and auditable.
                            </p>
                            <div class="ins-links">
                                <a href="#" class="ins-link" data-i18n="insurance.api_docs">üìä API Documentation</a>
                                <a href="#" class="ins-link" data-i18n="insurance.audit_reports">üîç Audit Reports</a>
                                <a href="#" class="ins-link" data-i18n="insurance.fund_policy">üìã Fund Policy</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Resize handle: center ‚Üî right -->
        <div class="resize-col" id="resizeRight"></div>

        <!-- RIGHT PANEL -->
        <aside class="panel panel-right" id="panelRight">
            <div class="book-section">
                <div class="panel-head">
                    <span class="panel-label" data-i18n="book.title">Order Book</span>
                    <div class="book-mode-group">
                        <button class="bm-btn active" data-mode="both" title="Both sides">‚´º</button>
                        <button class="bm-btn" data-mode="bids" title="Bids only">‚ñº</button>
                        <button class="bm-btn" data-mode="asks" title="Asks only">‚ñ≤</button>
                    </div>
                </div>
                <div class="book-header-row">
                    <span data-i18n="book.price">Price</span><span class="r" data-i18n="book.size">Size</span><span class="r" data-i18n="book.total">Total</span>
                </div>
                <div class="book-asks" id="bookAsks"></div>
                <div class="book-spread">
                    <span class="spread-lbl" data-i18n="book.spread">Spread</span>
                    <span class="spread-val" id="spreadVal">‚Äî</span>
                    <span class="spread-bps" id="spreadBps">‚Äî</span>
                </div>
                <div class="book-bids" id="bookBids"></div>
            </div>

            <div class="trade-section">
                <div class="panel-head">
                    <span class="panel-label" data-i18n="trade.title">Trade</span>
                    <span class="trade-sym" id="tradeSym">‚Äî</span>
                </div>
                <div class="side-toggle">
                    <button class="side-btn buy active" data-side="buy" data-i18n="trade.buy_long">BUY / LONG</button>
                    <button class="side-btn sell" data-side="sell" data-i18n="trade.sell_short">SELL / SHORT</button>
                </div>
                <div class="trade-field">
                    <label data-i18n="trade.order_type">Order Type</label>
                    <div class="otype-group">
                        <button class="otype-btn active" data-type="market" data-i18n="trade.market">Market</button>
                        <button class="otype-btn" data-type="limit" data-i18n="trade.limit">Limit</button>
                    </div>
                </div>
                <div class="trade-field limit-field hidden" id="limitPriceRow">
                    <label data-i18n="trade.price">Price</label>
                    <input type="text" class="t-input num" id="orderPrice" placeholder="0.00">
                </div>
                <div class="trade-field">
                    <label data-i18n="trade.size">Size</label>
                    <div class="size-group">
                        <input type="text" class="t-input num" id="orderQty" value="1" placeholder="0">
                        <span class="size-unit" id="sizeUnit">‚Äî</span>
                    </div>
                </div>
                <div class="size-pct-row">
                    <button class="pct-btn" data-pct="10">10%</button>
                    <button class="pct-btn" data-pct="25">25%</button>
                    <button class="pct-btn" data-pct="50">50%</button>
                    <button class="pct-btn" data-pct="75">75%</button>
                    <button class="pct-btn" data-pct="100">100%</button>
                </div>

                <!-- Leverage -->
                <div class="trade-field lev-field">
                    <label data-i18n="trade.leverage">Leverage</label>
                    <div class="lev-control">
                        <button class="lev-step" id="levMinus">‚àí</button>
                        <span class="lev-display" id="levDisplay">10x</span>
                        <input type="range" class="lev-slider" id="levSlider" min="1" max="100" value="10" step="1">
                        <button class="lev-step" id="levPlus">+</button>
                    </div>
                </div>

                <!-- TP / SL -->
                <div class="tpsl-section">
                    <label class="tpsl-check">
                        <input type="checkbox" id="tpslEnabled">
                        <span class="tpsl-label" data-i18n="trade.tp_sl">TP / SL</span>
                    </label>
                    <div class="tpsl-fields hidden" id="tpslFields">
                        <div class="tpsl-row">
                            <div class="tpsl-field">
                                <label class="green">TP</label>
                                <input type="text" class="t-input num" id="tpPrice" placeholder="‚Äî">
                            </div>
                            <div class="tpsl-field">
                                <label class="red">SL</label>
                                <input type="text" class="t-input num" id="slPrice" placeholder="‚Äî">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="trade-actions">
                    <button class="trade-btn buy-btn" id="buyBtn" title="Keyboard: B">
                        <span class="tb-label" data-i18n="trade.buy">BUY</span>
                        <span class="tb-price" id="buyPrice">‚Äî</span>
                    </button>
                    <button class="trade-btn sell-btn" id="sellBtn" title="Keyboard: S">
                        <span class="tb-label" data-i18n="trade.sell">SELL</span>
                        <span class="tb-price" id="sellPrice">‚Äî</span>
                    </button>
                </div>
                <div class="trade-hints" style="display:flex;justify-content:center;gap:12px;font-size:10px;color:var(--text-3);padding:2px 0">
                    <span><kbd style="background:var(--bg-3);padding:0 4px;border-radius:2px;font-family:var(--font-mono);font-size:9px">B</kbd> <span data-i18n="trade.hint_buy">Buy</span></span>
                    <span><kbd style="background:var(--bg-3);padding:0 4px;border-radius:2px;font-family:var(--font-mono);font-size:9px">S</kbd> <span data-i18n="trade.hint_sell">Sell</span></span>
                    <span><kbd style="background:var(--bg-3);padding:0 4px;border-radius:2px;font-family:var(--font-mono);font-size:9px">?</kbd> <span data-i18n="trade.hint_shortcuts">All shortcuts</span></span>
                </div>
                <div class="trade-summary">
                    <div class="ts-row"><span data-i18n="trade.notional">Notional</span><span class="num" id="estCost">‚Äî</span></div>
                    <div class="ts-row"><span><span data-i18n="trade.margin">Margin</span> (<span id="marginLevLabel">10x</span>)</span><span class="num" id="estMargin">‚Äî</span></div>
                    <div class="ts-row"><span><span data-i18n="trade.fee">Fee</span> (0.05%)</span><span class="num" id="estFee">‚Äî</span></div>
                    <div class="ts-row ts-liq"><span data-i18n="trade.est_liq">Est. Liq. Price</span><span class="num red" id="estLiq">‚Äî</span></div>
                </div>
            </div>

            <div class="info-section">
                <div class="panel-head">
                    <span class="panel-label" data-i18n="info.title">Market Info</span>
                </div>
                <div class="info-body" id="infoBody">
                    <div class="info-ctx hidden" id="productCtx">
                        <div class="ctx-name" id="prodName">‚Äî</div>
                        <div class="ctx-desc" id="prodDesc">‚Äî</div>
                    </div>
                    <div class="info-grid">
                        <div class="ig-row"><span data-i18n="info.volume_24h">Volume 24h</span><span class="num" id="infoVol">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.open_interest">Open Interest</span><span class="num" id="infoOI">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="funding.rate">Funding Rate</span><span class="num" id="fundingRate">‚Äî</span> <span class="num" id="fundingDirection" style="margin-left:2px"></span></div>
                        <div class="ig-row"><span data-i18n="funding.next_payment">Next Funding</span><span class="num" id="fundingCountdown">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.max_leverage">Max Leverage</span><span class="num" id="infoMaxLev">100x</span></div>
                    </div>
                    <div class="info-divider"></div>
                    <div class="info-transparency">
                        <div class="it-label" data-i18n="info.source">PRICE SOURCE</div>
                        <div class="ig-row"><span data-i18n="info.source">Source Symbol</span><span class="num" id="srcSymbol">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.src_price">Source Price</span><span class="num" id="srcPrice">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.usd_mnt">USD/MNT Rate</span><span class="num" id="srcRate">‚Äî</span></div>
                        <div class="ig-row calc"><span data-i18n="info.formula">Formula</span><span class="num" id="srcFormula">‚Äî</span></div>
                    </div>

                    <!-- USD/MNT Rates Comparison -->
                    <div class="info-divider"></div>
                    <div class="it-label" data-i18n="info.usd_mnt">USD/MNT RATES</div>
                    <div class="info-grid">
                        <div class="ig-row"><span data-i18n="fx.bom_ref">BoM Reference</span><span class="num" id="bomRateInfo">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.bank_mid">Bank Mid</span><span class="num" id="bankMidRate">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.cre_mid">CRE Mid</span><span class="num" id="creMidPrice">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.cre_spread">CRE Spread</span><span class="num" id="creSpread">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.bank_spread">Bank Spread</span><span class="num" id="bankSpread">‚Äî</span></div>
                        <div class="ig-row"><span class="green" data-i18n="info.you_save">You Save</span><span class="num green" id="youSave">‚Äî</span></div>
                        <div class="ig-row"><span data-i18n="info.updated">Updated</span><span class="num ts" id="rateTimestamp">‚Äî</span></div>
                    </div>

                    <!-- Bank Rates Comparison Grid -->
                    <div class="info-divider"></div>
                    <div class="it-label" data-i18n="info.bank_rates">BANK RATES (USD/MNT)</div>
                    <div class="bank-rates-grid">
                        <div class="br-header">
                            <span data-i18n="bank.bank">Bank</span><span class="num">Bid</span><span class="num">Ask</span><span class="num" data-i18n="bank.spread">Spread</span>
                        </div>
                        <div class="br-row"><span class="br-name">Khan</span><span class="num" id="bankKhanBid">‚Äî</span><span class="num" id="bankKhanAsk">‚Äî</span><span class="num" id="bankKhanSpread">‚Äî</span></div>
                        <div class="br-row"><span class="br-name">Golomt</span><span class="num" id="bankGolomtBid">‚Äî</span><span class="num" id="bankGolomtAsk">‚Äî</span><span class="num" id="bankGolomtSpread">‚Äî</span></div>
                        <div class="br-row"><span class="br-name">TDB</span><span class="num" id="bankTdbBid">‚Äî</span><span class="num" id="bankTdbAsk">‚Äî</span><span class="num" id="bankTdbSpread">‚Äî</span></div>
                        <div class="br-row"><span class="br-name">Xac</span><span class="num" id="bankXacBid">‚Äî</span><span class="num" id="bankXacAsk">‚Äî</span><span class="num" id="bankXacSpread">‚Äî</span></div>
                        <div class="br-row br-cre"><span class="br-name">CRE.mn</span><span class="num" id="bankCreBid">‚Äî</span><span class="num" id="bankCreAsk">‚Äî</span><span class="num" id="bankCreSpread">‚Äî</span></div>
                    </div>

                    <!-- Hidden mirror elements for bottom-panel/popup sync -->
                    <div style="display:none">
                        <span id="bomRateBp">‚Äî</span>
                        <span id="bankMidRateBp">‚Äî</span>
                        <span id="creMidPriceBp">‚Äî</span>
                        <span id="creSpreadBp">‚Äî</span>
                        <span id="bankSpreadBp">‚Äî</span>
                        <span id="youSaveBp">‚Äî</span>
                        <span id="infoVolBp">‚Äî</span>
                        <span id="infoOIBp">‚Äî</span>
                        <span id="fundingRateBp">‚Äî</span>
                        <span id="fundingDirectionBp">‚Äî</span>
                        <span id="fundingCountdownBp">‚Äî</span>
                        <span id="bankKhanBidBp">‚Äî</span><span id="bankKhanAskBp">‚Äî</span><span id="bankKhanSpreadBp">‚Äî</span>
                        <span id="bankGolomtBidBp">‚Äî</span><span id="bankGolomtAskBp">‚Äî</span><span id="bankGolomtSpreadBp">‚Äî</span>
                        <span id="bankTdbBidBp">‚Äî</span><span id="bankTdbAskBp">‚Äî</span><span id="bankTdbSpreadBp">‚Äî</span>
                        <span id="bankXacBidBp">‚Äî</span><span id="bankXacAskBp">‚Äî</span><span id="bankXacSpreadBp">‚Äî</span>
                        <span id="bankCreBidBp">‚Äî</span><span id="bankCreAskBp">‚Äî</span><span id="bankCreSpreadBp">‚Äî</span>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- ==================== TOAST CONTAINER ==================== -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- ==================== LOGIN MODAL ==================== -->
    <div class="modal-backdrop hidden" id="modalBackdrop">
        <div class="modal-card">
            <div class="modal-top">
                <h3 data-i18n="auth.title">Connect to CRE.mn</h3>
                <button class="modal-x" id="modalClose">&times;</button>
            </div>
            <div class="modal-content">
                <div class="auth-step active" id="stepPhone">
                    <div class="field-group">
                        <label>Phone Number</label>
                        <div class="phone-row">
                            <span class="phone-prefix">+976</span>
                            <input type="tel" class="t-input" id="phoneInput" placeholder="99001234" maxlength="8" autocomplete="tel">
                        </div>
                    </div>
                    <button class="btn-gold" id="sendCodeBtn" data-i18n="auth.send_code">Send Verification Code</button>
                    <div class="auth-note">SMS verification code will be sent to your number</div>
                </div>
                <div class="auth-step" id="stepOtp">
                    <p class="otp-info">Enter the 6-digit code sent to your phone</p>
                    <div class="otp-row" id="otpRow">
                        <input type="text" class="otp-digit" maxlength="1" inputmode="numeric">
                        <input type="text" class="otp-digit" maxlength="1" inputmode="numeric">
                        <input type="text" class="otp-digit" maxlength="1" inputmode="numeric">
                        <input type="text" class="otp-digit" maxlength="1" inputmode="numeric">
                        <input type="text" class="otp-digit" maxlength="1" inputmode="numeric">
                        <input type="text" class="otp-digit" maxlength="1" inputmode="numeric">
                    </div>
                    <button class="btn-gold" id="verifyBtn" data-i18n="auth.verify">Verify & Connect</button>
                    <button class="btn-link" id="changeNumBtn">Change number</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== ORDER CONFIRM MODAL ==================== -->
    <div class="modal-backdrop hidden" id="confirmBackdrop">
        <div class="modal-card confirm-card">
            <div class="modal-top">
                <h3 data-i18n="confirm.title">Confirm Order</h3>
                <button class="modal-x" id="confirmClose">&times;</button>
            </div>
            <div class="modal-content">
                <div class="confirm-body" id="confirmBody"></div>
                <div class="confirm-actions">
                    <button class="btn-cancel-confirm" id="confirmCancel" data-i18n="confirm.cancel">Cancel</button>
                    <button class="btn-confirm" id="confirmOk" data-i18n="confirm.place">Place Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== EDIT ORDER MODAL ==================== -->
    <div class="modal-backdrop hidden" id="editBackdrop">
        <div class="modal-card edit-card">
            <div class="modal-top">
                <h3 data-i18n="edit.title">Modify Order</h3>
                <button class="modal-x" id="editCloseBtn">&times;</button>
            </div>
            <div class="modal-content">
                <div class="edit-order-info">
                    <div class="edit-row">
                        <span class="edit-label">Symbol</span>
                        <span class="edit-value" id="editSymbol">‚Äî</span>
                    </div>
                    <div class="edit-row">
                        <span class="edit-label">Side</span>
                        <span class="edit-value" id="editSide">‚Äî</span>
                    </div>
                </div>
                <div class="edit-inputs">
                    <div class="input-group">
                        <label for="editPrice">New Price</label>
                        <input type="number" id="editPrice" step="0.01" placeholder="Price">
                    </div>
                    <div class="input-group">
                        <label for="editQty">New Quantity</label>
                        <input type="number" id="editQty" step="0.01" placeholder="Quantity">
                    </div>
                </div>
                <div class="edit-actions">
                    <button class="btn-cancel-confirm" id="editCancelBtn">Cancel</button>
                    <button class="btn-confirm buy" id="editSubmitBtn">Modify Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== DEPOSIT / WITHDRAW MODAL ==================== -->
    <div class="modal-backdrop hidden" id="depositBackdrop">
        <div class="modal-card deposit-card">
            <div class="modal-top">
                <h3 id="depositTitle">Deposit</h3>
                <button class="modal-x" id="depositClose">&times;</button>
            </div>
            <div class="modal-content">
                <div class="deposit-tabs">
                    <button class="dep-tab active" data-dt="deposit">Deposit</button>
                    <button class="dep-tab" data-dt="withdraw">Withdraw</button>
                </div>
                <div class="dep-pane active" id="depPaneDeposit">
                    <div class="dep-method">
                        <div class="dep-method-btn active" data-method="qpay">
                            <span class="dep-m-icon">üè¶</span><span>QPay</span>
                        </div>
                        <div class="dep-method-btn" data-method="bank">
                            <span class="dep-m-icon">üèß</span><span>Bank Transfer</span>
                        </div>
                    </div>
                    <div class="field-group">
                        <label>Amount (MNT)</label>
                        <input type="text" class="t-input num w-full" id="depositAmt" placeholder="0">
                    </div>
                    <div class="dep-presets">
                        <button class="dep-ps" data-amt="100000">100K</button>
                        <button class="dep-ps" data-amt="500000">500K</button>
                        <button class="dep-ps" data-amt="1000000">1M</button>
                        <button class="dep-ps" data-amt="5000000">5M</button>
                    </div>
                    <button class="btn-gold" id="submitDeposit" data-i18n="deposit.generate">Generate Payment</button>
                    <div class="qr-area hidden" id="qrArea">
                        <div class="qr-code" id="qrCode">QR</div>
                        <div class="qr-info">Scan with QPay to complete deposit</div>
                        <div class="qr-timer">Expires in <span id="qrTimer">5:00</span></div>
                    </div>
                </div>
                <div class="dep-pane" id="depPaneWithdraw">
                    <div class="field-group">
                        <label>Amount (MNT)</label>
                        <input type="text" class="t-input num w-full" id="withdrawAmt" placeholder="0">
                    </div>
                    <div class="field-group">
                        <label>Bank Account</label>
                        <input type="text" class="t-input w-full" id="withdrawAcct" placeholder="Account number">
                    </div>
                    <div class="field-group">
                        <label>Bank Name</label>
                        <select class="t-select w-full" id="withdrawBank">
                            <option value="">Select bank</option>
                            <option value="khan">Khan Bank</option>
                            <option value="golomt">Golomt Bank</option>
                            <option value="tdb">TDB</option>
                            <option value="xac">XacBank</option>
                            <option value="state">State Bank</option>
                            <option value="bogd">Bogd Bank</option>
                        </select>
                    </div>
                    <button class="btn-gold" id="submitWithdraw">Submit Withdrawal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== KEYBOARD SHORTCUTS ==================== -->
    <div class="modal-backdrop hidden" id="shortcutsBackdrop">
        <div class="modal-card shortcuts-card">
            <div class="modal-top">
                <h3 data-i18n="shortcuts.title">Keyboard Shortcuts</h3>
                <button class="modal-x" id="shortcutsClose">&times;</button>
            </div>
            <div class="modal-content">
                <div class="shortcuts-grid">
                    <div class="sc-group">
                        <div class="sc-group-title">Trading</div>
                        <div class="sc-row"><kbd>B</kbd><span>Quick Buy</span></div>
                        <div class="sc-row"><kbd>S</kbd><span>Quick Sell</span></div>
                        <div class="sc-row"><kbd>Esc</kbd><span>Close modals</span></div>
                    </div>
                    <div class="sc-group">
                        <div class="sc-group-title">Navigation</div>
                        <div class="sc-row"><kbd>‚Üë</kbd><span>Previous market</span></div>
                        <div class="sc-row"><kbd>‚Üì</kbd><span>Next market</span></div>
                        <div class="sc-row"><kbd>/</kbd><span>Search markets</span></div>
                    </div>
                    <div class="sc-group">
                        <div class="sc-group-title">Interface</div>
                        <div class="sc-row"><kbd>T</kbd><span>Toggle theme</span></div>
                        <div class="sc-row"><kbd>?</kbd><span>Show shortcuts</span></div>
                        <div class="sc-row"><kbd>1-5</kbd><span>Switch tabs</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="popupContainer"></div>

    <script src="cre-chart.js"></script>
    <script src="i18n.js"></script>
    <script src="app.js"></script>
</body>
</html>
